<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Harmon√≥grafo: M√∫sica Visual - Geometr√≠a Sagrada TOP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Simulador de Harmon√≥grafo y Figuras de Lissajous. Visualiza la armon√≠a musical y las proporciones sagradas a trav√©s del movimiento de p√©ndulos.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3150277567590534" crossorigin="anonymous"></script>

    <style>
        /* ESTILO "CRYSTAL FORGE PRO" - THEME: LASER HARMONY */
        html, body { 
            margin: 0; padding: 0; background-color: #000; font-family: 'Segoe UI', sans-serif; color: #ddd; 
            overflow-x: hidden; overscroll-behavior: none;
        }
        
        #app-wrapper { 
            display: flex; width: 100%; height: 100vh; overflow: hidden; position: relative;
        }
        
        #canvas-container {
            flex: 3; position: relative;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            cursor: default; overflow: hidden; touch-action: none;
        }
        canvas { display: block; width: 100%; height: 100%; }

        #controls-container {
            flex: 2; min-width: 320px; background-color: #080808; padding: 25px;
            overflow-y: auto; box-shadow: -5px 0 30px rgba(0,0,0,0.8); border-left: 1px solid #222; z-index: 10;
        }

        /* T√≠tulos en Verde Lima Ne√≥n (Energ√≠a Vital) */
        h2 { color: #39ff14; margin: 0 0 15px 0; text-align: center; letter-spacing: 2px; text-transform: uppercase; text-shadow: 0 0 15px rgba(57, 255, 20, 0.4); }
        
        /* BOTONES */
        .btn-group { display: flex; gap: 10px; margin-bottom: 25px; }
        .export-btn {
            flex: 1; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;
            transition: transform 0.1s, filter 0.2s; font-size: 0.9em;
        }
        .export-btn:hover { filter: brightness(1.2); transform: translateY(-2px); }
        #btnPng { background-color: #39ff14; color: #000; } 
        #btnJpg { background-color: #fff; color: #000; } 

        .control-group { background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .control-row { display: flex; align-items: center; margin-bottom: 12px; font-size: 0.9em; justify-content: space-between; }
        .control-label { color: #ccc; font-weight: 500; flex: 1; }
        
        input[type=range] { flex: 2; cursor: pointer; accent-color: #39ff14; }
        input[type=color] { border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; padding: 0; overflow: hidden; }
        .value-display { flex: 0.5; text-align: right; font-family: monospace; color: #39ff14; font-size: 0.9em; }

        .btn-main {
            width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
            background: linear-gradient(45deg, #2ecc71, #39ff14); color: #000; font-size: 1em;
            transition: all 0.3s; box-shadow: 0 0 10px rgba(57, 255, 20, 0.2);
        }
        .btn-main:hover { filter: brightness(1.2); letter-spacing: 1px; }

        /* Presets */
        .preset-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .btn-preset { background: #1a1a1a; color: #aaa; border: 1px solid #333; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em; transition: 0.2s;}
        .btn-preset:hover { background: #252525; color: #fff; border-color: #39ff14; }
        .btn-preset.active { background: rgba(57, 255, 20, 0.2); color: #fff; border-color: #39ff14; }

        /* SECCI√ìN INFORMATIVA */
        .content-section { max-width: 900px; margin: 0 auto; padding: 60px 20px; background-color: #000; position: relative; z-index: 20; }
        .ad-placeholder {
            width: 100%; height: 120px; background: #0f0f0f; margin: 40px 0;
            border: 1px dashed #333; display: flex; align-items: center; justify-content: center; color: #444; font-size: 0.9em; font-style: italic;
        }
        article h2 { color: #39ff14; border-left: 4px solid #39ff14; padding-left: 15px; margin-top: 60px; font-size: 2em; letter-spacing: 1px;}
        article h3 { color: #fff; margin-top: 40px; font-size: 1.5em; border-bottom: 1px solid #333; padding-bottom: 10px; }
        article p { margin-bottom: 20px; font-size: 1.1em; color: #ccc; line-height: 1.8; text-align: justify; }
        article ul { list-style: none; padding: 0; }
        article li { margin-bottom: 15px; padding-left: 20px; border-left: 2px solid #39ff14; color: #bbb; }
        article strong { color: #39ff14; }

        footer { background-color: #080808; padding: 50px 20px; text-align: center; border-top: 1px solid #222; font-size: 0.9em; color: #666; position: relative; z-index: 20;}
        footer a { color: #888; text-decoration: none; margin: 0 10px; transition: color 0.3s; }
        footer a:hover { color: #39ff14; }

        @media (max-width: 800px) and (orientation: portrait) {
            #app-wrapper { display: block; height: auto; }
            #canvas-container { height: 50vh; border-bottom: 2px solid #39ff14; }
            #controls-container { height: auto; }
        }
        @media (max-width: 900px) and (orientation: landscape) {
            #controls-container { padding: 15px; }
            h2 { font-size: 1.2em; }
            .control-group { padding: 10px; margin-bottom: 10px; }
        }
    </style>
</head>
<body>

<div id="app-wrapper">
    <div id="canvas-container">
        <canvas id="harmonographCanvas"></canvas>
    </div>

    <div id="controls-container">
        <h2>Harmon√≥grafo</h2>
        
        <div class="btn-group">
            <button id="btnPng" class="export-btn">üíæ Guardar PNG</button>
            <button id="btnJpg" class="export-btn">üì∏ Guardar JPG</button>
        </div>

        <button id="btnDraw" class="btn-main">üñãÔ∏è Soltar P√©ndulos (Dibujar)</button>

        <div class="control-group">
            <h3 style="margin:0 0 10px 0; color:#fff; font-size:0.9em; border-bottom:1px solid #444; padding-bottom:5px;">Acordes Visuales (Presets)</h3>
            <div class="preset-grid">
                <button class="btn-preset active" onclick="setPreset('unison')">Un√≠sono (1:1)</button>
                <button class="btn-preset" onclick="setPreset('octave')">Octava (2:1)</button>
                <button class="btn-preset" onclick="setPreset('fifth')">Quinta (3:2)</button>
                <button class="btn-preset" onclick="setPreset('fourth')">Cuarta (4:3)</button>
                <button class="btn-preset" onclick="setPreset('complex')">Complejo</button>
                <button class="btn-preset" onclick="setPreset('chaos')">Disonancia</button>
            </div>
        </div>

        <div class="control-group">
            <h3 style="margin:0 0 10px 0; color:#fff; font-size:0.9em; border-bottom:1px solid #444; padding-bottom:5px;">P√©ndulos (Frecuencias)</h3>
            
            <div class="control-row">
                <span class="control-label">P√©ndulo A (Eje X)</span>
                <input type="range" id="freqA" min="1" max="10" step="0.01" value="2.0">
                <span id="valA" class="value-display">2.00</span>
            </div>
            <div class="control-row">
                <span class="control-label">P√©ndulo B (Eje Y)</span>
                <input type="range" id="freqB" min="1" max="10" step="0.01" value="3.0">
                <span id="valB" class="value-display">3.00</span>
            </div>
            <div class="control-row">
                <span class="control-label">Fricci√≥n (Duraci√≥n)</span>
                <input type="range" id="damping" min="0.0001" max="0.002" step="0.0001" value="0.0005">
            </div>
            <div class="control-row">
                <span class="control-label">Desfase (Giro)</span>
                <input type="range" id="phase" min="0" max="360" step="1" value="90">
                <span id="valPhase" class="value-display">90¬∞</span>
            </div>
        </div>

        <div class="control-group">
            <h3 style="margin:0 0 10px 0; color:#fff; font-size:0.9em; border-bottom:1px solid #444; padding-bottom:5px;">Estilo Pluma</h3>
            <div class="control-row">
                <span class="control-label">Color Luz</span>
                <input type="color" id="penColor" value="#39ff14">
            </div>
            <div class="control-row">
                <span class="control-label">Grosor</span>
                <input type="range" id="penWidth" min="0.1" max="2" step="0.1" value="0.5">
            </div>
        </div>

        <div style="text-align:center; margin-top:20px;">
            <a href="../index.html" style="color:#39ff14; text-decoration:none; font-weight:bold; font-size:0.9em;">‚Üê Volver al Hub Central</a>
        </div>
    </div>
</div>

<section class="content-section">
    <div class="ad-placeholder">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3150277567590534"
     crossorigin="anonymous"></script>
<!-- banner_harmonograph_lab -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3150277567590534"
     data-ad-slot="5982671569"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>

    <article>
        <h2>La Danza de los P√©ndulos: Geometr√≠a Musical</h2>
        <p>Has llegado a la √∫ltima herramienta de la colecci√≥n: el <strong>Harmon√≥grafo</strong>. Este dispositivo fue muy popular en el siglo XIX para visualizar la armon√≠a musical.</p>
        <p>Imagina dos o tres p√©ndulos oscilando. Uno mueve un papel y el otro mueve un bol√≠grafo. El dibujo resultante es el registro del movimiento combinado de ambos. En f√≠sica, estas curvas se conocen como <strong>Figuras de Lissajous</strong>.</p>

        <h3>C√≥mo leer los dibujos</h3>
        <p>Lo que ves en la pantalla es literalmente un acorde musical dibujado:</p>
        <ul>
            <li><strong>Consonancia (Belleza):</strong> Cuando las frecuencias de los p√©ndulos est√°n en una proporci√≥n num√©rica simple (ej: 2:1, 3:2, 4:3), el dibujo es cerrado, sim√©trico y estable. Esto equivale a un sonido agradable al o√≠do.</li>
            <li><strong>Disonancia (Caos):</strong> Cuando las proporciones son complejas (ej: 2.14 : 3.89), el dibujo nunca se cierra sobre s√≠ mismo, creando una malla densa y desordenada.</li>
        </ul>

        <h3>Los Presets Sagrados</h3>
        <p>Utiliza los botones de arriba para ver las relaciones cl√°sicas:</p>
        <ul>
            <li><strong>Un√≠sono (1:1):</strong> Dos notas iguales. Crea un c√≠rculo o una l√≠nea (el origen).</li>
            <li><strong>Octava (2:1):</strong> La misma nota pero m√°s aguda. Crea una forma de "8" o par√°bola.</li>
            <li><strong>Quinta Perfecta (3:2):</strong> El intervalo m√°s sagrado despu√©s de la octava. Crea nudos complejos y hermosos.</li>
        </ul>
        <p>Observa c√≥mo el dibujo empieza siendo grande y se va haciendo peque√±o hacia el centro. Esto se debe a la <strong>fricci√≥n</strong> (damping). Todo movimiento en el universo f√≠sico pierde energ√≠a con el tiempo, y esta espiral hacia la quietud es lo que le da la belleza org√°nica al trazo.</p>
    </article>

    <div class="ad-placeholder">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3150277567590534"
     crossorigin="anonymous"></script>
<!-- banner_harmonograph_lab -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3150277567590534"
     data-ad-slot="5982671569"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
</section>

<footer>
    <div style="margin-bottom: 30px;">
        <p style="margin-bottom: 10px; color: #aaa;">¬øTe ha fascinado la geometr√≠a?</p>
        <a href="https://www.paypal.com/paypalme/pbazan" target="_blank" style="display: inline-block; background-color: #0070BA; color: white; padding: 10px 20px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 0.9em; box-shadow: 0 4px 15px rgba(0,112,186, 0.3);">‚òï Inv√≠tame a un caf√©</a>
    </div>
    <p>&copy; 2025 Geometr√≠a Sagrada Top.</p>
    <br>
    <a href="../legal.html#privacidad">Pol√≠tica de Privacidad</a> | <a href="../legal.html#terminos">T√©rminos</a> | <a href="mailto:geometriasagradatop@gmail.com">Contacto</a>
</footer>

<script>
    const canvas = document.getElementById('harmonographCanvas');
    const ctx = canvas.getContext('2d');

    // ESTADO
    const state = {
        freqA: 2.0,       // Frecuencia X
        freqB: 3.0,       // Frecuencia Y
        ampA: 200,        // Amplitud inicial X (calculada en resize)
        ampB: 200,        // Amplitud inicial Y
        phase: 90,        // Desfase en grados
        damping: 0.0005,  // Fricci√≥n
        penColor: '#39ff14',
        penWidth: 0.5,
        isDrawing: false,
        time: 0,
        maxTime: 6000     // L√≠mite de dibujo
    };

    // Puntos del trazado actual
    let points = [];
    let animationId;

    function init() {
        resize();
        window.addEventListener('resize', resize);
        setupControls();
        startDrawing(); // Empezar dibujando la Quinta por defecto
    }

    function resize() {
        const parent = canvas.parentElement;
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        
        // Ajustar amplitud al tama√±o de pantalla
        const minDim = Math.min(canvas.width, canvas.height);
        state.ampA = minDim * 0.4;
        state.ampB = minDim * 0.4;
        
        if(!state.isDrawing) drawStatic(); // Redibujar si est√° parado
    }

    function startDrawing() {
        // Reiniciar
        state.isDrawing = true;
        state.time = 0;
        points = [];
        
        // Cancelar animaci√≥n anterior si existe
        if(animationId) cancelAnimationFrame(animationId);
        
        // Limpiar
        ctx.fillStyle = '#000';
        ctx.fillRect(0,0, canvas.width, canvas.height);
        
        animate();
    }

    function animate() {
        if (!state.isDrawing) return;

        // Dibujar m√∫ltiples pasos por frame para velocidad
        const stepsPerFrame = 10;
        const dt = 0.05; // Delta tiempo

        ctx.strokeStyle = state.penColor;
        ctx.lineWidth = state.penWidth;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.beginPath();

        // Mover al √∫ltimo punto conocido (o centro si es el primero)
        if (points.length > 0) {
            const lastP = points[points.length - 1];
            ctx.moveTo(lastP.x, lastP.y);
        }

        for (let i = 0; i < stepsPerFrame; i++) {
            state.time += dt;
            
            // --- F√ìRMULA DEL HARMON√ìGRAFO ---
            // x = A * sin(f1 * t + p1) * exp(-d1 * t)
            // y = B * sin(f2 * t + p2) * exp(-d2 * t)
            
            const phaseRad = state.phase * Math.PI / 180;
            const decay = Math.exp(-state.damping * state.time);
            
            // Si la energ√≠a es muy baja, paramos
            if (decay < 0.01) {
                state.isDrawing = false;
                break;
            }

            const x = canvas.width/2 + state.ampA * Math.sin(state.freqA * state.time) * decay;
            const y = canvas.height/2 + state.ampB * Math.sin(state.freqB * state.time + phaseRad) * decay;

            ctx.lineTo(x, y);
            points.push({x, y});
        }
        
        ctx.stroke();

        if (state.isDrawing) {
            animationId = requestAnimationFrame(animate);
        }
    }

    function drawStatic() {
        // Redibujar todo el array de puntos existente (para resize o exportaci√≥n)
        ctx.fillStyle = '#000';
        ctx.fillRect(0,0, canvas.width, canvas.height);
        
        if(points.length < 2) return;

        ctx.strokeStyle = state.penColor;
        ctx.lineWidth = state.penWidth;
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        
        for(let i=1; i<points.length; i++) {
            ctx.lineTo(points[i].x, points[i].y);
        }
        ctx.stroke();
    }

    function setupControls() {
        // Sliders
        const faInput = document.getElementById('freqA');
        const faVal = document.getElementById('valA');
        faInput.oninput = (e) => { state.freqA = parseFloat(e.target.value); faVal.innerText = state.freqA.toFixed(2); startDrawing(); };

        const fbInput = document.getElementById('freqB');
        const fbVal = document.getElementById('valB');
        fbInput.oninput = (e) => { state.freqB = parseFloat(e.target.value); fbVal.innerText = state.freqB.toFixed(2); startDrawing(); };

        document.getElementById('damping').oninput = (e) => { state.damping = parseFloat(e.target.value); startDrawing(); };
        
        const phInput = document.getElementById('phase');
        const phVal = document.getElementById('valPhase');
        phInput.oninput = (e) => { state.phase = parseInt(e.target.value); phVal.innerText = state.phase + '¬∞'; startDrawing(); };

        document.getElementById('penColor').oninput = (e) => { 
            state.penColor = e.target.value; 
            if(!state.isDrawing) drawStatic(); 
        };
        
        document.getElementById('penWidth').oninput = (e) => { 
            state.penWidth = parseFloat(e.target.value); 
            if(!state.isDrawing) drawStatic();
        };

        // Bot√≥n Principal
        document.getElementById('btnDraw').onclick = () => startDrawing();

        // Exportar
        document.getElementById('btnPng').onclick = () => saveImage('png');
        document.getElementById('btnJpg').onclick = () => saveImage('jpeg');
    }

    // Presets
    window.setPreset = (mode) => {
        // UI
        document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');

        // Logic
        if(mode === 'unison') {
            updateSliders(1.0, 1.0, 90);
        } else if(mode === 'octave') {
            updateSliders(1.0, 2.0, 90);
        } else if(mode === 'fifth') {
            updateSliders(2.0, 3.0, 90);
        } else if(mode === 'fourth') {
            updateSliders(3.0, 4.0, 90);
        } else if(mode === 'complex') {
            updateSliders(2.01, 3.01, 45); // Desafinaci√≥n ligera crea "rotaci√≥n"
        } else if(mode === 'chaos') {
            updateSliders(Math.random()*5, Math.random()*5, Math.random()*360);
        }
        startDrawing();
    };

    function updateSliders(fa, fb, ph) {
        state.freqA = fa;
        state.freqB = fb;
        state.phase = ph;
        
        document.getElementById('freqA').value = fa;
        document.getElementById('valA').innerText = fa.toFixed(2);
        
        document.getElementById('freqB').value = fb;
        document.getElementById('valB').innerText = fb.toFixed(2);
        
        document.getElementById('phase').value = ph;
        document.getElementById('valPhase').innerText = ph + '¬∞';
    }

    function saveImage(format) {
        if(format === 'jpeg') {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tCtx = tempCanvas.getContext('2d');
            tCtx.fillStyle = '#000';
            tCtx.fillRect(0,0, canvas.width, canvas.height);
            tCtx.drawImage(canvas, 0, 0);
            
            const link = document.createElement('a');
            link.download = `harmonografo.${format}`;
            link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
            link.click();
        } else {
            const link = document.createElement('a');
            link.download = `harmonografo.${format}`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    }

    init();
</script>
</body>
</html>
